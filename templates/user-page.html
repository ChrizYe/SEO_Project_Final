{% extends "layout.html" %} {% block content %}

<!DOCTYPE html>
<html>
  <head> </head>
  <body>
    <header class="header">
      <div class="title-wrapper">
        <h1 class="title userpage">{{userName}}'s Page</h1>
      </div>
      <a href="{{url_for('main_page')}}" class="user-container">
        <p class="username">
          <i
            class="bi bi-house-fill"
            style="margin-right: 5px; display: inline"
          ></i
          >Home
        </p>
      </a>
    </header>

    <main class="main-container">
      <h1>Account Settings</h1>

      <div class="change-info-container">
        <div class="change-option">
          <h2 class="settings-option">Update Username</h2>
          <form method="POST" action="{{ url_for('user_page') }}">
            {{ username_form.hidden_tag() }}

            <!-- Username  -->
            {{ username_form.username(class="settings-input", placeholder="New Username") }} 
            {% for error in username_form.username.errors %}
            <div class="error">{{ error }}</div>
            {% endfor %} {% with messages =
            get_flashed_messages(with_categories=true) %} {% for category,
            message in messages %} {% if category == 'username' %}
            <div class="alert alert-danger">{{ message }}</div>
            {% endif %} {% endfor %} {% endwith %}

            <!-- Current Password  -->
            {{ username_form.current_password(class="settings-input",
            placeholder="Current Password") }} {% for error in
            username_form.current_password.errors %}
            <div class="error">{{ error }}</div>
            {% endfor %} {% with messages =
            get_flashed_messages(with_categories=true) %} {% for category,
            message in messages %} {% if category == 'username_password' %}
            <div class="alert alert-danger">{{ message }}</div>
            {% endif %} {% endfor %} {% endwith %} {{
            username_form.submit_username(class="submit-btn") }}
          </form>
        </div>

        <div class="change-option">
          <!-- Update Email -->
          <h2 class="settings-option">Update Email</h2>
          <form method="POST" action="{{ url_for('user_page') }}">
            {{ email_form.hidden_tag() }}

            <!-- Email  -->
            {{ email_form.email(class="settings-input", placeholder="New Email")
            }} {% for error in email_form.email.errors %}
            <div class="error">{{ error }}</div>
            {% endfor %} {% with messages =
            get_flashed_messages(with_categories=true) %} {% for category,
            message in messages %} {% if category == 'email' %}
            <div class="alert alert-danger">{{ message }}</div>
            {% endif %} {% endfor %} {% endwith %}

            <!-- Current Password  -->
            {{ email_form.current_password(class="settings-input",
            placeholder="Current Password") }} {% for error in
            email_form.current_password.errors %}
            <div class="error">{{ error }}</div>
            {% endfor %} {% with messages =
            get_flashed_messages(with_categories=true) %} {% for category,
            message in messages %} {% if category == 'email_password' %}
            <div class="alert alert-danger">{{ message }}</div>
            {% endif %} {% endfor %} {% endwith %} {{
            email_form.submit_email(class="submit-btn") }}
          </form>
        </div>

        <div class="change-option">
          <!-- Change Password -->
          <h2 class="settings-option">Change Password</h2>
          <form method="POST" action="{{ url_for('user_page') }}">
            {{ password_form.hidden_tag() }}

            <!-- Current Password  -->
            {{ password_form.current_password(class="settings-input",
            placeholder="Current Password") }} {% for error in
            password_form.current_password.errors %}
            <div class="error">{{ error }}</div>
            {% endfor %} {% with messages =
            get_flashed_messages(with_categories=true) %} {% for category,
            message in messages %} {% if category == 'password_current' %}
            <div class="alert alert-danger">{{ message }}</div>
            {% endif %} {% endfor %} {% endwith %}

            <!-- New Password  -->
            {{ password_form.new_password(class="settings-input",
            placeholder="New Password") }} {% for error in
            password_form.new_password.errors %}
            <div class="error">{{ error }}</div>
            {% endfor %}

            <!-- Confirm New Password  -->
            {{ password_form.confirm_new_password(class="settings-input",
            placeholder="Confirm New Password") }} {% for error in
            password_form.confirm_new_password.errors %}
            <div class="error">{{ error }}</div>
            {% endfor %} {{ password_form.submit_password(class="submit-btn") }}
            {% with messages = get_flashed_messages(with_categories=true) %} {%
            for category, message in messages %} {% if category
            =='password_success' %}
            <div class="alert alert-success">{{ message }}</div>
            {% endif %} {% endfor %} {% endwith %}
          </form>
        </div>
      </div>
    </main>

    <main class="main-container">
      <h1>Log Out</h1>
      <a class="option logout" href="{{ url_for('logout') }}">
        <span class="bi bi-door-closed"></span>Exit</a
      >
      <h1>Your Favorites</h1>

      {% if has_favorites %} {% for article in articles %}
      <a
        href="{{ url_for('show_fav_article', index=loop.index0 + ((current_page - 1) * 3)) }}"
      >
        <div class="news-container">
          <div class="news-img-div">
            <img src="{{article.urlToImage}}" alt="" />
          </div>
          <div class="info-container">
            <div class="news-title-date">
              <p>{{ article.title }}</p>
              <p>{{ article.author }}</p>
            </div>
            <p class="descriptions">{{ article.description }}</p>
          </div>
        </div>
      </a>
      {% endfor %}

      <div class="pagination">
        {% if current_page > 1 %}
        <a
          class="pagination-option"
          href="{{request.path }}?page={{current_page - 1}}"
          >Previous</a
        >
        {% endif %} {% if current_page < total_pages %}
        <a
          class="pagination-option"
          href="{{request.path }}?page={{current_page + 1}}"
          >Next</a
        >
        {% endif %}
      </div>
      {% endif %} {% if not has_favorites %}
      <h3 style="margin-left: 20px; font-weight: 300;">You dont have any favorites yet</h3>
      {% endif %}
    </main>
  </body>
</html>
{% endblock content %}
